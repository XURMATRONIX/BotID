<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ŒõN√òM Security</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { 
            background-color: var(--tg-theme-bg-color, #000); 
            color: var(--tg-theme-text-color, #fff); 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            height: 100vh; 
            font-family: sans-serif;
        }
        #status { margin-top: 20px; font-size: 18px; }
        .fingerprint-icon { font-size: 64px; }
    </style>
</head>
<body>
    <div class="fingerprint-icon">üîí</div>
    <div id="status">Biometrik tekshiruv...</div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand(); // Oynani to'liq ochish

        const bm = tg.BiometricManager;

        function initBiometrics() {
            if (!bm.isInited) {
                bm.init(() => {
                    checkBiometrics();
                });
            } else {
                checkBiometrics();
            }
        }

        function checkBiometrics() {
            if (!bm.isBiometricAvailable) {
                document.getElementById('status').innerText = "Biometriya topilmadi!";
                return;
            }

            bm.requestAccess({
                reason: "ŒõN√òM tizimiga kirish uchun tasdiqlang"
            }, (granted) => {
                if (granted) {
                    authenticate();
                } else {
                    document.getElementById('status').innerText = "Ruxsat berilmadi!";
                }
            });
        }

        function authenticate() {
            bm.authenticate({
                reason: "Shaxsingizni tasdiqlang"
            }, (success, token) => {
                if (success) {
                    document.getElementById('status').innerText = "‚úÖ Tasdiqlandi!";
                    // MUVAFFAQIYATLI BO'LSA, ESP32 GA XABAR YUBORAMIZ
                    tg.sendData("BIOMETRIC_SUCCESS_KEY_9988"); 
                } else {
                    document.getElementById('status').innerText = "‚ùå Xatolik!";
                }
            });
        }

        // Ilova ochilishi bilan tekshirishni boshlash
        initBiometrics();
    </script>
</body>
</html>